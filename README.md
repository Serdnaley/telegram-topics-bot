# Telegram Topic Discussions Bot

This project was generated by ChatGPT using the following prompt:

```text
Let's make step by step implementation using aiogram package with the specification described above. Write full content of files that I should copy.

I have 1 group with many topics with some content managed by me only and a few open conversational topics for general themes. 
Each topic is a Telegram native topic-based discussion.
I want to chose which topic should be managed by bot and which not (it could be stored in database manually, just topic ids).
Use python native sqlite for data storage.

For the topics logic let's take a look on that sequence:
Prerequisites:
- News - topic of some news of my group. Managed only by me.
- Announces - topic for some announces. Managed only by me.
- General - topic for general discussion. Everyone can write.
- Chat: We made 1m dollars last month - discussion created by bot from the post in the News channel.
- Chat: ... - other discussions managed by bot.
- Chat: empty - empty topic to be used in the future.

At first of all we should create some amount of topics manually and store their ids in the database.
So when the bot starts we should check count of topics in the database and create new ones if we don't have enough. The maximum managed discussion topics should be stored in config. For now let's take 10 topics to managed by bot for discussions.

The next step is to check the topics managed by bot to get new posts. We should store it manually in the database, so for now we can just set topic ids for News and Anounces topics in the config file.
When we have some activity in the discussion topics we should update the last activity date for each of them.

When the new message posted in the source topics we should get the first line of the message and assign the last topic (ordered by last activity date) and rename it with the title of the post. Even if all the topics are not empty - we should find the least active one and reuse it for new theme.
Then we should forward that message to the chat topic to let users start discussion.
The name of discussion topic should be in format "Chat: {first line of the post}"

All the configs should be described in config.py. Use .env to store the values of the configs.
```

## Overview

This project is a Telegram bot built using the `aiogram` 3.11 framework. The bot is designed to manage topics within a Telegram supergroup, allowing for the automatic creation, management, and reuse of discussion topics. The bot handles the following functionalities:

- Automatically creating new topics in a Telegram supergroup.
- Renaming and reusing existing topics based on new posts in specified source topics.
- Storing and tracking topic activity using SQLite for data persistence.
- Configuring all settings and environment variables via a `.env` file.

## Features

- **Topic Creation**: The bot dynamically creates new discussion topics in the Telegram group when the number of managed topics falls below the configured limit.
- **Topic Management**: The bot renames and reuses the least active discussion topic based on new posts in the source topics.
- **Activity Tracking**: The bot tracks activity in each topic and updates the last activity timestamp in the SQLite database.
- **Environment Configuration**: All configurations, such as bot token, chat ID, and database file location, are stored in a `.env` file for easy management and security.

## Installation

### Prerequisites

- Python 3.7 or later
- A Telegram bot token from [BotFather](https://core.telegram.org/bots#botfather)
- A Telegram supergroup with forum topics enabled

### Step 1: Clone the Repository

```bash
git clone https://github.com/yourusername/telegram-topic-discussions-bot.git
cd telegram-topic-discussions-bot
```

### Step 2: Set Up the Environment

1. Create a virtual environment:

   ```bash
   python3 -m venv venv
   source venv/bin/activate  # On Windows use `venv\Scripts\activate`
   ```

2. Install the required dependencies:

   ```bash
   pip install -r requirements.txt
   ```

3. Create a `.env` file in the root directory with the following content:

   ```plaintext
   BOT_TOKEN=your_bot_token_here
   CHAT_ID=-1002159888172
   NEWS_TOPIC_ID=1
   ANNOUNCES_TOPIC_ID=20
   MAX_MANAGED_TOPICS=10
   DATABASE_FILE=topics.db
   ```

   Replace `your_bot_token_here` with your actual Telegram bot token.

### Step 3: Run the Bot

```bash
python bot.py
```

The bot will start, create any necessary topics, and begin managing discussions based on the logic specified.

## Project Structure

- **bot.py**: The main bot implementation using `aiogram` 3.11.
- **config.py**: Loads environment variables from the `.env` file.
- **database.py**: Manages SQLite database interactions for storing and tracking topic activity.
- **.env**: Stores configuration settings (not included in version control).

## Usage

- The bot will automatically create and manage discussion topics within a Telegram supergroup.
- Use the `/start` command to initialize the bot.
- The bot will monitor specified source topics and reuse the least active discussion topics for new posts.

## License

This project is licensed under the MIT License. See the [LICENSE](LICENSE) file for details.

## Acknowledgements

This project was generated by ChatGPT based on user specifications. Special thanks to OpenAI for the development and support of the GPT models.

```

### Save the README

Save this content in a file named `README.md` in the root directory of your project.

### Ensure You Have the Following Files:

- `README.md`: The file you just created.
- `.env`: The file containing your bot token and other configurations.
- `bot.py`, `config.py`, and `database.py`: The Python files as described in the instructions.

This `README.md` provides comprehensive instructions for setting up, running, and understanding the project.